{"title":"","date":"2018-11-05T05:24:35.874Z","slug":"Mybatis笔记","updated":"2018-11-04T17:08:33.811Z","content":"<h3 id=\"为什么学Mybatis\"><a href=\"#为什么学Mybatis\" class=\"headerlink\" title=\"为什么学Mybatis\"></a>为什么学Mybatis</h3><blockquote>\n<ol>\n<li>目前最主流的持久层框架为hibernate与mybatis，而且国内目前情况使用Mybatis的公司比hibernate要多。</li>\n<li>Hibernate学习门槛不低，要精通门槛更高。门槛高在怎么设计O/R映射，在性能和对象模型之间如何权衡取得平衡，以及怎样用好Hibernate缓存与数据加载策略方面需要你的经验和能力都很强才行。国内目前的情况精通hibernate技术大牛非常少。</li>\n<li>sql优化方面，Hibernate的查询会将表中的所有字段查询出来，这一点会有性能消耗。当然了，Hibernate也可以自己写SQL来指定需要查询的字段，但这样就破坏了Hibernate开发的简洁性。说得更深入一些，如果有个查询要关联多张表，比如5张表，10张表时，而且，我们要取的字段只是其中几张表的部分字段。这时用hibernate时就会显得非常力不从心。就算用hibernate的sqlquery，后续的维护工作也会让人发狂。</li>\n</ol>\n</blockquote>\n<h3 id=\"JDBC编程回顾与存在的问题分析\"><a href=\"#JDBC编程回顾与存在的问题分析\" class=\"headerlink\" title=\"JDBC编程回顾与存在的问题分析\"></a>JDBC编程回顾与存在的问题分析</h3><ul>\n<li><p>开发步骤：</p>\n<ol>\n<li>导入数据脚本，在课前资料中有</li>\n<li>创建工程，导入mysql jar包</li>\n<li>编码</li>\n</ol>\n</li>\n<li><p>Jdbc访问数据库的过程：</p>\n<ol>\n<li>加载数据库驱动</li>\n<li>创建数据库连接</li>\n<li>创建statement</li>\n<li>设置sql语句</li>\n<li>设置查询参数</li>\n<li>执行查询，得到ResultSet</li>\n<li>解析结果集ResultSet</li>\n<li>释放资源</li>\n</ol>\n</li>\n<li><p>Jdbc存在的问题：</p>\n<ol>\n<li>频繁创建和打开、关闭数据连接，太消耗资源</li>\n<li>Sql语句存在硬编码，不利于维护</li>\n<li>Sql参数设置硬编码，不利于维护</li>\n<li>结果集获取与遍历复杂，存在硬编码，不利于维护，期望能够查询后返回一个java对象</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"Mybatis介绍\"><a href=\"#Mybatis介绍\" class=\"headerlink\" title=\"Mybatis介绍\"></a>Mybatis介绍</h3><blockquote>\n<p>MyBatis 本是apache的一个开源项目iBatis, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis 。2013年11月迁移到Github。</p>\n</blockquote>\n<blockquote>\n<p>Mybatis是面向sql的持久层框架，他封装了jdbc访问数据库的过程，我们开发，只需专注于sql语句本身的拼装，其它复杂的过程全部可以交给mybatis去完成。</p>\n</blockquote>\n<h4 id=\"Mybaits入门\"><a href=\"#Mybaits入门\" class=\"headerlink\" title=\"Mybaits入门\"></a>Mybaits入门</h4><ul>\n<li><p>需求列表</p>\n<blockquote>\n<ul>\n<li>根据用户ID查询用户信息</li>\n<li>根据用户名查找用户列表</li>\n<li>添加用户</li>\n<li>修改用户</li>\n<li>删除用户</li>\n</ul>\n</blockquote>\n</li>\n<li><p>工程搭建</p>\n<ol>\n<li>导入依赖jar包</li>\n<li><p>配置SqlMapConfig.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span></span><br><span class=\"line\">  <span class=\"meta\">&lt;!DOCTYPE configuration</span></span><br><span class=\"line\"><span class=\"meta\">  PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"</span></span><br><span class=\"line\"><span class=\"meta\">  \"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"comment\">&lt;!-- 和spring整合后 environments配置将废除 --&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">environments</span> <span class=\"attr\">default</span>=<span class=\"string\">\"development\"</span>&gt;</span></span><br><span class=\"line\">  \t\t<span class=\"tag\">&lt;<span class=\"name\">environment</span> <span class=\"attr\">id</span>=<span class=\"string\">\"development\"</span>&gt;</span></span><br><span class=\"line\">  \t\t\t<span class=\"comment\">&lt;!-- 使用jdbc事务管理 --&gt;</span></span><br><span class=\"line\">  \t\t\t<span class=\"tag\">&lt;<span class=\"name\">transactionManager</span> <span class=\"attr\">type</span>=<span class=\"string\">\"JDBC\"</span> /&gt;</span></span><br><span class=\"line\">  \t\t\t<span class=\"comment\">&lt;!-- 数据库连接池 --&gt;</span></span><br><span class=\"line\">  \t\t\t<span class=\"tag\">&lt;<span class=\"name\">dataSource</span> <span class=\"attr\">type</span>=<span class=\"string\">\"POOLED\"</span>&gt;</span></span><br><span class=\"line\">  \t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></span><br><span class=\"line\">  \t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span></span></span><br><span class=\"line\"><span class=\"tag\">  \t\t\t\t\t<span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8\"</span> /&gt;</span></span><br><span class=\"line\">  \t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></span><br><span class=\"line\">  \t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></span><br><span class=\"line\">  \t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dataSource</span>&gt;</span></span><br><span class=\"line\">  \t\t<span class=\"tag\">&lt;/<span class=\"name\">environment</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;/<span class=\"name\">environments</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 加载配置文件 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mappers</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"mybatis/user.xml\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>配置log4j.properties</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Global logging configuration</span><br><span class=\"line\">  log4j.rootLogger=DEBUG, stdout</span><br><span class=\"line\">  # Console output...</span><br><span class=\"line\">  log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span><br><span class=\"line\">  log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span><br><span class=\"line\">  log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在课前资料复制pojo到工程目录下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Order</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"comment\">// 订单id</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> id;</span><br><span class=\"line\">   <span class=\"comment\">// 用户id</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> Integer userId;</span><br><span class=\"line\">   <span class=\"comment\">// 订单号</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> String number;</span><br><span class=\"line\">   <span class=\"comment\">// 订单创建时间</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> Date createtime;</span><br><span class=\"line\">   <span class=\"comment\">// 备注</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> String note;</span><br><span class=\"line\">  get/set。。。</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>配置sql查询的映射文件，可参考课前资料</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span></span><br><span class=\"line\">  <span class=\"meta\">&lt;!DOCTYPE mapper</span></span><br><span class=\"line\"><span class=\"meta\">  PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"</span></span><br><span class=\"line\"><span class=\"meta\">  \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"test\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>加载映射文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 加载配置文件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mappers</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"mybatis/user.xml\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><p>完成需求</p>\n<blockquote>\n<p>需求完成步骤</p>\n<ol>\n<li>编写sql语句</li>\n<li>配置user映射文件</li>\n<li>编写测试程序</li>\n</ol>\n</blockquote>\n<ul>\n<li><p>根据用户ID查询用户信息</p>\n<ol>\n<li><p>映射文件与sql</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- id:statementId</span></span><br><span class=\"line\"><span class=\"comment\">\t\t resultType:查询结果集的数据类型</span></span><br><span class=\"line\"><span class=\"comment\">\t\t parameterType:查询的入参</span></span><br><span class=\"line\"><span class=\"comment\">\t--&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"getUserById\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"int\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"com.itheima.mybatis.pojo.User\"</span> &gt;</span></span><br><span class=\"line\">\t\tSELECT * FROM USER WHERE id = #&#123;id1&#125;</span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>MyBatis访问数据库代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testGetUserByid</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 创建SqlSessionFactoryBuilder对象</span></span><br><span class=\"line\">\t\tSqlSessionFactoryBuilder sfb = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder();</span><br><span class=\"line\">\t\t<span class=\"comment\">// 查找配置文件创建输入流</span></span><br><span class=\"line\">\t\tInputStream inputStream = Resources.getResourceAsStream(<span class=\"string\">\"SqlMapConfig.xml\"</span>);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 加载配置文件，创建SqlSessionFactory对象</span></span><br><span class=\"line\">\t\tSqlSessionFactory\tsqlSessionFactory = sfb.build(inputStream);</span><br><span class=\"line\">\t\t<span class=\"comment\">// 创建SqlSession对象</span></span><br><span class=\"line\">\t\tSqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class=\"line\">\t\t<span class=\"comment\">// 执行查询，参数一：要查询的statementId ,参数二：sql语句入参</span></span><br><span class=\"line\">\t\tUser user = sqlSession.selectOne(<span class=\"string\">\"user.getUserById\"</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// 输出查询结果</span></span><br><span class=\"line\">\t\tSystem.out.println(user);</span><br><span class=\"line\">\t\t<span class=\"comment\">// 释放资源</span></span><br><span class=\"line\">\t\tsqlSession.close();</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p><font color=\"red\">3. 抽取SqlSessionFactoryUtils工具类，共享SqlSessionFactory创建过程</font></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * SqlSessionFactory工具类</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Steven</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"> <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SqlSessionFactoryUtils</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 单例SqlSessionFactory</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">     <span class=\"comment\">// 创建SqlSessionFactoryBuilder对象</span></span><br><span class=\"line\">     SqlSessionFactoryBuilder sfb = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder();</span><br><span class=\"line\">     <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">       <span class=\"comment\">// 查找配置文件创建输入流</span></span><br><span class=\"line\">       InputStream inputStream = Resources.getResourceAsStream(<span class=\"string\">\"SqlMapConfig.xml\"</span>);</span><br><span class=\"line\">       <span class=\"comment\">// 加载配置文件，创建SqlSessionFactory对象</span></span><br><span class=\"line\">       sqlSessionFactory = sfb.build(inputStream);</span><br><span class=\"line\">     &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">       e.printStackTrace();</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 获取单例SqlSessionFactory</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> SqlSessionFactory <span class=\"title\">getSqlSessionFactory</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> sqlSessionFactory;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>根据用户名查找用户列表</p>\n<ol>\n<li><p>映射文件与sql</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- resultType:如果要返回数据集合，只需设定为每一个元素的数据类型 --&gt;</span><br><span class=\"line\">\t&lt;select id=&quot;getUserByName&quot; parameterType=&quot;string&quot; resultType=&quot;com.itheima.mybatis.pojo.User&quot;&gt;</span><br><span class=\"line\">\t\t&lt;!-- SELECT * FROM USER WHERE username LIKE #&#123;name&#125; --&gt;</span><br><span class=\"line\">\t\tSELECT * FROM USER WHERE username LIKE &apos;%$&#123;value&#125;%&apos;</span><br><span class=\"line\">\t&lt;/select&gt;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>MyBatis访问数据库代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getUserByName</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tSqlSession sqlSession = SqlSessionFactoryUtils.getSqlSessionFactory().openSession();</span><br><span class=\"line\">        <span class=\"comment\">//List&lt;User&gt; users = sqlSession.selectList(\"user.getUserByName\", \"%张%\");</span></span><br><span class=\"line\">\t\tList&lt;User&gt; users = sqlSession.selectList(<span class=\"string\">\"user.getUserByName\"</span>, <span class=\"string\">\"张\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (User user : users) &#123;</span><br><span class=\"line\">\t\t\tSystem.out.println(user);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// 释放资源</span></span><br><span class=\"line\">\t\tsqlSession.close();</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><p>添加用户</p>\n<ol>\n<li><p>映射文件与sql</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">\"insertUser\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"com.itheima.mybatis.pojo.User\"</span>&gt;</span></span><br><span class=\"line\">\t\tINSERT INTO USER</span><br><span class=\"line\">\t\t            (`username`,</span><br><span class=\"line\">\t\t             `birthday`,</span><br><span class=\"line\">\t\t             `sex`,</span><br><span class=\"line\">\t\t             `address`)</span><br><span class=\"line\">\t\tVALUES (#&#123;username&#125;,</span><br><span class=\"line\">\t\t        #&#123;birthday&#125;,</span><br><span class=\"line\">\t\t        #&#123;sex&#125;,</span><br><span class=\"line\">\t\t        #&#123;address&#125;);</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>MyBatis访问数据库代码</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testInsertUser</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// 创建SqlSession对象</span></span><br><span class=\"line\">\t\tSqlSession sqlSession = SqlSessionFactoryUtils.getSqlSessionFactory().openSession();</span><br><span class=\"line\">\t\tUser user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">\t\tuser.setUsername(<span class=\"string\">\"张飞\"</span>);</span><br><span class=\"line\">\t\tuser.setAddress(<span class=\"string\">\"深圳市黑马\"</span>);</span><br><span class=\"line\">\t\tuser.setBirthday(<span class=\"keyword\">new</span> Date());</span><br><span class=\"line\">\t\tuser.setSex(<span class=\"string\">\"1\"</span>);</span><br><span class=\"line\">\t\t<span class=\"comment\">// 执行插入</span></span><br><span class=\"line\">\t\tsqlSession.insert(<span class=\"string\">\"user.insertUser\"</span>, user);</span><br><span class=\"line\">\t\t<span class=\"comment\">// 提交事务</span></span><br><span class=\"line\">\t\tsqlSession.commit();</span><br><span class=\"line\">\t\t<span class=\"comment\">// 释放资源</span></span><br><span class=\"line\">\t\tsqlSession.close();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">```  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">3</span>. Mysql自增返回</span><br><span class=\"line\">``` xml</span><br><span class=\"line\">&lt;!-- useGeneratedKeys:标识插入使用自增id</span><br><span class=\"line\">     keyProperty:与useGeneratedKeys配套使用，用于绑定主键接收的pojo属性</span><br><span class=\"line\">   --&gt;</span><br><span class=\"line\">   &lt;insert id=<span class=\"string\">\"insertUserKey\"</span> parameterType=<span class=\"string\">\"com.itheima.mybatis.pojo.User\"</span> useGeneratedKeys=<span class=\"string\">\"true\"</span> keyProperty=<span class=\"string\">\"id\"</span>&gt;</span><br><span class=\"line\">    &lt;!-- selectKey:用于配置主键返回</span><br><span class=\"line\">       keyProperty：要绑定的pojo属性</span><br><span class=\"line\">       resultType:属性数据类型</span><br><span class=\"line\">       order:指定什么时候执行，AFTER之后</span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- &lt;selectKey keyProperty=<span class=\"string\">\"id\"</span> resultType=<span class=\"string\">\"int\"</span> order=<span class=\"string\">\"AFTER\"</span>&gt;</span><br><span class=\"line\">       <span class=\"function\">SELECT <span class=\"title\">LAST_INSERT_ID</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    &lt;/selectKey&gt; --&gt;</span></span><br><span class=\"line\"><span class=\"function\">INSERT INTO USER</span></span><br><span class=\"line\"><span class=\"function\">                <span class=\"params\">(`username`,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                 `birthday`,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                 `sex`,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                 `address`,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                 `uuid2`)</span></span></span><br><span class=\"line\"><span class=\"function\">    <span class=\"title\">VALUES</span> <span class=\"params\">(#&#123;username&#125;,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">            #&#123;birthday&#125;,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">            #&#123;sex&#125;,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">            #&#123;address&#125;,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">            #&#123;uuid2&#125;)</span></span>;</span><br><span class=\"line\">  &lt;/insert&gt;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Mysql的uuid返回主键</p>\n<blockquote>\n<p>注：在使用uuid之前数据库user表要先加上uuid2字段、user的pojo也要加上相应属性</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- useGeneratedKeys:标识插入使用自增id</span></span><br><span class=\"line\"><span class=\"comment\">\t\t keyProperty:与useGeneratedKeys配套使用，用于绑定主键接收的pojo属性</span></span><br><span class=\"line\"><span class=\"comment\">\t --&gt;</span></span><br><span class=\"line\">\t <span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">\"insertUserUUID\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"com.itheima.mybatis.pojo.User\"</span>&gt;</span></span><br><span class=\"line\">\t \t<span class=\"comment\">&lt;!-- selectKey:用于配置主键返回</span></span><br><span class=\"line\"><span class=\"comment\">\t \t\t keyProperty：要绑定的pojo属性</span></span><br><span class=\"line\"><span class=\"comment\">\t \t\t resultType:属性数据类型</span></span><br><span class=\"line\"><span class=\"comment\">\t \t\t order:指定什么时候执行，BEFORE之前</span></span><br><span class=\"line\"><span class=\"comment\">\t \t--&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">selectKey</span> <span class=\"attr\">keyProperty</span>=<span class=\"string\">\"uuid2\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"string\"</span> <span class=\"attr\">order</span>=<span class=\"string\">\"BEFORE\"</span>&gt;</span></span><br><span class=\"line\">\t\t\tSELECT UUID()</span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">selectKey</span>&gt;</span></span><br><span class=\"line\">\t\tINSERT INTO USER</span><br><span class=\"line\">\t\t            (`username`,</span><br><span class=\"line\">\t\t             `birthday`,</span><br><span class=\"line\">\t\t             `sex`,</span><br><span class=\"line\">\t\t             `address`,</span><br><span class=\"line\">\t\t             `uuid2`)</span><br><span class=\"line\">\t\tVALUES (#&#123;username&#125;,</span><br><span class=\"line\">\t\t        #&#123;birthday&#125;,</span><br><span class=\"line\">\t\t        #&#123;sex&#125;,</span><br><span class=\"line\">\t\t        #&#123;address&#125;,</span><br><span class=\"line\">\t\t        #&#123;uuid2&#125;);</span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><p>修改用户</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">update</span> <span class=\"attr\">id</span>=<span class=\"string\">\"updateUser\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"com.itheima.mybatis.pojo.User\"</span>&gt;</span></span><br><span class=\"line\">\t\tUPDATE USER SET username = #&#123;username&#125; WHERE id = #&#123;id&#125;</span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">update</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>删除用户</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">delete</span> <span class=\"attr\">id</span>=<span class=\"string\">\"deleteUser\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"int\"</span>&gt;</span></span><br><span class=\"line\">\t\tDELETE FROM `user` WHERE `id` = #&#123;id1&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>小结与Mybatis架构图</p>\n<ul>\n<li><p><font color=\"red\">映射文件Mapper标记中#与$的区别 </font></p>\n<ul>\n<li>#{}：点位符，相当于jdbc的？</li>\n<li>${}：字符串拼接指令，如果入参为普通数据类型，括号内部职能用value</li>\n</ul>\n</li>\n<li><p>架构图</p>\n<p><img src=\"MyBatis架构图.png\" alt=\"Mybatis\"></p>\n</li>\n</ul>\n</li>\n</ul>\n","prev":{"title":"Mybatis笔记.md","slug":"Mybatis笔记-md"},"link":"http://yoursite.com/post/Mybatis笔记/"}